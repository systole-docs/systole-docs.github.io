<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Installation &#8212; systole 0.1.1 documentation</title>
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="_static/gallery-dataframe.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#"><span><img src="_static/logo.png"></span>
          systole</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="api.html">Functions</a></li>
                <li><a href="auto_examples/index.html">Tutorials</a></li>
                <li><a href="https://github.com/embodied-computation-group/systole">GitHub</a></li>
                <li><a href="changelog.html">What's new</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"></ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#">Installation</a></li>
<li><a class="reference internal" href="#recording">Recording</a><ul>
<li><a class="reference internal" href="#interfacing-with-psychopy">Interfacing with PsychoPy</a></li>
<li><a class="reference internal" href="#online-detection">Online detection</a></li>
</ul>
</li>
<li><a class="reference internal" href="#peaks-detection">Peaks detection</a></li>
<li><a class="reference internal" href="#artefact-removal">Artefact removal</a></li>
<li><a class="reference internal" href="#heartrate-variability">Heartrate variability</a></li>
<li><a class="reference internal" href="#development">Development</a></li>
<li><a class="reference internal" href="#acknowledgements">Acknowledgements</a></li>
<li><a class="reference internal" href="#references">References</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
              
            
            
            
            
              <li class="hidden-sm">
<div id="sourcelink">
  <a href="_sources/index.rst.txt"
     rel="nofollow">Source</a>
</div></li>
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <a class="reference external image-reference" href="https://github.com/embodied-computation-group/systole/blob/master/LICENSE"><img alt="https://img.shields.io/badge/License-GPL%20v3-blue.svg" src="https://img.shields.io/badge/License-GPL%20v3-blue.svg" /></a>
<a class="reference external image-reference" href="https://badge.fury.io/py/systole"><img alt="https://badge.fury.io/py/systole.svg" src="https://badge.fury.io/py/systole.svg" /></a>
<a class="reference external image-reference" href="https://zenodo.org/badge/latestdoi/219720901"><img alt="https://zenodo.org/badge/219720901.svg" src="https://zenodo.org/badge/219720901.svg" /></a>
<a class="reference external image-reference" href="https://travis-ci.org/embodied-computation-group/systole"><img alt="https://travis-ci.org/embodied-computation-group/systole.svg?branch=master" src="https://travis-ci.org/embodied-computation-group/systole.svg?branch=master" /></a>
<a class="reference external image-reference" href="https://codecov.io/gh/embodied-computation-group/systole"><img alt="https://codecov.io/gh/embodied-computation-group/systole/branch/master/graph/badge.svg" src="https://codecov.io/gh/embodied-computation-group/systole/branch/master/graph/badge.svg" /></a>
<hr class="docutils" />
<div class="figure align-center">
<img alt="https://github.com/embodied-computation-group/systole/raw/master/source/images/banner.png" src="https://github.com/embodied-computation-group/systole/raw/master/source/images/banner.png" />
</div>
<hr class="docutils" />
<p><strong>Systole</strong> is an open-source Python package providing simple tools to record and analyze, cardiac signals for psychophysiology.
In particular, the package provides tools to pre-process, analyze, and synchronize cardiac data from psychophysiology research.
This includes tools for data epoching, heart-rate variability, and synchronizing stimulus presentation with different cardiac phases via psychopy.</p>
<p>The documentation can be found under the following <a class="reference external" href="https://embodied-computation-group.github.io/">link</a>.</p>
<div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>Systole can be installed using pip:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install systole
</pre></div>
</div>
<p>The following packages are required to use Systole:</p>
<ul class="simple">
<li><p>Numpy (&gt;=1.15)</p></li>
<li><p>SciPy (&gt;=1.3.0)</p></li>
<li><p>Pandas (&gt;=0.24)</p></li>
<li><p>Matplotlib (&gt;=3.0.2)</p></li>
<li><p>Seaborn (&gt;=0.9.0)</p></li>
</ul>
</div>
<div class="section" id="recording">
<h1>Recording<a class="headerlink" href="#recording" title="Permalink to this headline">¶</a></h1>
<p>Systole natively supports the recording of PPG signals through the <a class="reference external" href="https://www.nonin.com/products/xpod/">Nonin 3012LP Xpod USB pulse oximeter</a> together with the <a class="reference external" href="https://www.nonin.com/products/8000s/">Nonin 8000SM ‘soft-clip’ fingertip sensors</a>.
It can easily interface with <a class="reference external" href="https://www.psychopy.org/">PsychoPy</a> to record PPG signal during psychological experiments, and to synchronize stimulus deliver to e.g., systole or diastole.</p>
<p>For example, you can record and plot data in less than 6 lines of code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">from</span> <span class="nn">systole.recording</span> <span class="kn">import</span> <span class="n">Oximeter</span>
<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s1">&#39;COM4&#39;</span><span class="p">)</span>  <span class="c1"># Add your USB port here</span>

<span class="c1"># Open serial port, initialize and plot recording for Oximeter</span>
<span class="n">oxi</span> <span class="o">=</span> <span class="n">Oximeter</span><span class="p">(</span><span class="n">serial</span><span class="o">=</span><span class="n">ser</span><span class="p">)</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="interfacing-with-psychopy">
<h2>Interfacing with PsychoPy<a class="headerlink" href="#interfacing-with-psychopy" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">Oximeter</span></code> class can be used together with a stimulus presentation software to record cardiac activity during psychological experiments.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">read()</span></code> method</p></li>
</ul>
<p>will record for a predefined amount of time (specified by the <code class="docutils literal notranslate"><span class="pre">duration</span></code> parameter, in seconds). This ‘serial mode’ is the easiest and most robust method, but it does not allow the execution of other instructions in the meantime.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Code 1 {}</span>
<span class="n">oximeter</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">duration</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="c1"># Code 2 {}</span>
</pre></div>
</div>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">readInWaiting()</span></code> method</p></li>
</ul>
<p>will only read the bytes temporally stored in the USB buffer. For the Nonin device, this represents up to 10 seconds of recording (this procedure should be executed at least one time every 10 seconds for a continuous recording). When inserted into a while loop, it can record PPG signal in parallel with other commands.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>
<span class="n">tstart</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">tstart</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="n">oximeter</span><span class="o">.</span><span class="n">readInWaiting</span><span class="p">()</span>
    <span class="c1"># Insert code here {...}</span>
</pre></div>
</div>
</div>
<div class="section" id="online-detection">
<h2>Online detection<a class="headerlink" href="#online-detection" title="Permalink to this headline">¶</a></h2>
<p>Online heart beat detection, for cardiac-stimulus synchrony:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">systole.recording</span> <span class="kn">import</span> <span class="n">Oximeter</span>

<span class="c1"># Open serial port</span>
<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">(</span><span class="s1">&#39;COM4&#39;</span><span class="p">)</span>  <span class="c1"># Change this value according to your setup</span>

<span class="c1"># Create an Oxymeter instance and initialize recording</span>
<span class="n">oxi</span> <span class="o">=</span> <span class="n">Oximeter</span><span class="p">(</span><span class="n">serial</span><span class="o">=</span><span class="n">ser</span><span class="p">,</span> <span class="n">sfreq</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">add_channels</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">setup</span><span class="p">()</span>

<span class="c1"># Online peak detection for 10 seconds</span>
<span class="n">tstart</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">tstart</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
    <span class="k">while</span> <span class="n">oxi</span><span class="o">.</span><span class="n">serial</span><span class="o">.</span><span class="n">inWaiting</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="n">paquet</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">oxi</span><span class="o">.</span><span class="n">serial</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">oxi</span><span class="o">.</span><span class="n">add_paquet</span><span class="p">(</span><span class="n">paquet</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  <span class="c1"># Add new data point</span>
        <span class="k">if</span> <span class="n">oxi</span><span class="o">.</span><span class="n">peaks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
          <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Heartbeat detected&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="peaks-detection">
<h1>Peaks detection<a class="headerlink" href="#peaks-detection" title="Permalink to this headline">¶</a></h1>
<p>Heartbeats can be detected in the PPG signal either online or offline.</p>
<p>Methods from clipping correction and peak detection algorithm is adapted from <a class="footnote-reference brackets" href="#id3" id="id1">1</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot data</span>
<span class="n">oxi</span><span class="o">.</span><span class="n">plot_oximeter</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="https://github.com/embodied-computation-group/systole/raw/master/Images/recording.png" src="https://github.com/embodied-computation-group/systole/raw/master/Images/recording.png" />
</div>
</div>
<div class="section" id="artefact-removal">
<h1>Artefact removal<a class="headerlink" href="#artefact-removal" title="Permalink to this headline">¶</a></h1>
<p>Systole implements the artefact rejection method recently proposed by Lipponen &amp; Tarvainen (2019) <a class="footnote-reference brackets" href="#id4" id="id2">2</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">systole</span> <span class="kn">import</span> <span class="n">import_rr</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">systole.plotting</span> <span class="kn">import</span> <span class="n">plot_subspaces</span>

<span class="n">rr</span> <span class="o">=</span> <span class="n">import_rr</span><span class="p">()</span><span class="o">.</span><span class="n">rr</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
<span class="n">rr</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1600</span>  <span class="c1"># Add missed beat</span>

<span class="n">plot_subspaces</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="https://github.com/embodied-computation-group/systole/raw/master/Images/subspaces.png" src="https://github.com/embodied-computation-group/systole/raw/master/Images/subspaces.png" />
</div>
</div>
<div class="section" id="heartrate-variability">
<h1>Heartrate variability<a class="headerlink" href="#heartrate-variability" title="Permalink to this headline">¶</a></h1>
<p>Systole supports basic time-domain, frequency-domain and non-linear extraction indices.</p>
<p>All time-domain and non-linear indices have been tested against Kubios HVR 2.2 (&lt;<a class="reference external" href="https://www.kubios.com">https://www.kubios.com</a>&gt;). The frequency-domain indices can slightly differ. We recommend to always check your results against another software.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">systole.hrv</span> <span class="kn">import</span> <span class="n">plot_psd</span>

<span class="n">plot_psd</span><span class="p">(</span><span class="n">rr</span><span class="p">)</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="https://github.com/embodied-computation-group/systole/raw/master/Images/psd.png" src="https://github.com/embodied-computation-group/systole/raw/master/Images/psd.png" />
</div>
</div>
<div class="section" id="development">
<h1>Development<a class="headerlink" href="#development" title="Permalink to this headline">¶</a></h1>
<p>This module was created and is maintained by Nicolas Legrand and Micah Allen (ECG group, <a class="reference external" href="https://the-ecg.org/">https://the-ecg.org/</a>). If you want to contribute, feel free to contact one of the contributors, open an issue or submit a pull request.</p>
<p>This program is provided with NO WARRANTY OF ANY KIND.</p>
</div>
<div class="section" id="acknowledgements">
<h1>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h1>
<p>This software and the ECG are supported by a Lundbeckfonden Fellowship (R272-2017-4345), and the AIAS-COFUND II fellowship programme that is supported by the Marie Skłodowska-Curie actions under the European Union’s Horizon 2020 (Grant agreement no 754513), and the Aarhus University Research Foundation.</p>
<p>Systole was largely inspired by pre-existing toolboxes dedicated to heartrate variability and signal analysis.</p>
<ul class="simple">
<li><p>HeartPy: <a class="reference external" href="https://python-heart-rate-analysis-toolkit.readthedocs.io/en/latest/">https://python-heart-rate-analysis-toolkit.readthedocs.io/en/latest/</a></p></li>
<li><p>hrv: <a class="reference external" href="https://github.com/rhenanbartels/hrv">https://github.com/rhenanbartels/hrv</a></p></li>
<li><p>ECG-detector: <a class="reference external" href="https://github.com/berndporr/py-ecg-detectors">https://github.com/berndporr/py-ecg-detectors</a></p></li>
<li><p>Pingouin: <a class="reference external" href="https://pingouin-stats.org/">https://pingouin-stats.org/</a></p></li>
</ul>
</div>
<div class="section" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h1>
<p><strong>Peak detection (PPG signal)</strong></p>
<dl class="footnote brackets">
<dt class="label" id="id3"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>van Gent, P., Farah, H., van Nes, N., &amp; van Arem, B. (2019). HeartPy: A novel heart rate algorithm for the analysis of noisy signals. Transportation Research Part F: Traffic Psychology and Behaviour, 66, 368–378. <a class="reference external" href="https://doi.org/10.1016/j.trf.2019.09.015">https://doi.org/10.1016/j.trf.2019.09.015</a></p>
</dd>
</dl>
<p><strong>Artefact detection and correction:</strong></p>
<dl class="footnote brackets">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id2">2</a></span></dt>
<dd><p>Lipponen, J. A., &amp; Tarvainen, M. P. (2019). A robust algorithm for heart rate variability time series artefact correction using novel beat classification. <em>Journal of Medical Engineering &amp; Technology, 43(3), 173–181</em>. <a class="reference external" href="https://doi.org/10.1080/03091902.2019.1640306">https://doi.org/10.1080/03091902.2019.1640306</a></p>
</dd>
</dl>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2020, Nicolas Legrand.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>